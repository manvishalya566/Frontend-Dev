<div id="list"></div>

<script>
const loadEmployees = () => {
    const xhr = new XMLHttpRequest();
    xhr.open("GET", "http://localhost:3002/employees");
    xhr.onload = () => {
        const data = JSON.parse(xhr.responseText);
        let html = "";

        data.forEach(emp => {
            html += `
                <div>
                    <strong>${emp.name}</strong>  
                    <label>
                        <input type="checkbox" ${emp.status === "active" ? "checked" : ""} 
                            onchange="toggleStatus(${emp.id}, this)">
                        ${emp.status}
                    </label>
                </div>`;
        });

        document.getElementById("list").innerHTML = html;
    };
    xhr.send();
};

function toggleStatus(id, checkbox) {
    let newStatus = checkbox.checked ? "active" : "inactive";

    const xhr = new XMLHttpRequest();
    xhr.open("PATCH", `http://localhost:3002/employees/${id}`);
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onload = () => {
        if (xhr.status >= 200 && xhr.status < 300) {
            checkbox.nextSibling.textContent = newStatus;
        } else {
            checkbox.checked = !checkbox.checked;
            alert("Error updating");
        }
    };

    xhr.send(JSON.stringify({ status: newStatus }));
}

loadEmployees();
</script>
