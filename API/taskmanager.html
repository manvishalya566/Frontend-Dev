<select id="filter">
  <option value="">All</option>
  <option value="Low">Low Priority</option>
  <option value="Medium">Medium Priority</option>
  <option value="High">High Priority</option>
  <option value="completed">Completed</option>
</select>

<div id="taskList"></div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
function loadTasks(filter = "") {
    let url = "http://localhost:3003/tasks";

    if (filter === "completed") {
        url += "?completed=true";
    } else if (filter) {
        url += `?priority=${filter}`;
    }

    $.get(url, function (tasks) {
        let html = "";
        tasks.forEach(t => {
            html += `
                <div>
                    <input type="checkbox" ${t.completed ? "checked" : ""} 
                        onclick="toggleTask(${t.id}, ${t.completed})">
                    <strong>${t.title}</strong> - ${t.priority}
                </div>`;
        });

        $("#taskList").html(html);
    });
}

function toggleTask(id, current) {
    $.ajax({
        url: "http://localhost:3003/tasks/" + id,
        method: "PATCH",
        data: { completed: !current },
        success: () => loadTasks($("#filter").val())
    });
}

$("#filter").change(function () {
    loadTasks($(this).val());
});

loadTasks();
</script>
